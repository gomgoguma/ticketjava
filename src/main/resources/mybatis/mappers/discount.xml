<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="discount">

	<select id="selectList" parameterType="int" resultType="DiscountVo">
		<![CDATA[
			select dc_no dcNo,
				   dcname dcName,
				   begindc beginDc,
				   enddc endDc,
				   dcrate dcRate,
				   dctype dcType
			from discount
			where prod_no = #{prodNo}
			order by begindc desc ,dctype, dcrate
		]]>
	</select>


	<!-- 특정공연 이벤트할인 등록창 -->
	<select id="selectProdDiscount" parameterType="DiscountVo" resultType="DiscountVo">
		<![CDATA[
			select			prodname, 
							hallname, 
							dcname,
							d.dc_no dcNo, 
							d.prod_no prodNo, 
							begindc, 
							enddc, 
							dcrate, 
							dctype
			from 			product p, hall h, discount d
			where 			p.hall_no= h.hall_no
			and 			p.prod_no= d.prod_no
			and 			d.prod_no= #{prodNo}
		]]>
	</select>

	<!-- 특정공연 이름&공연장 불러오기 -->
	<select id="selectProdHall" parameterType="DiscountVo" resultType="DiscountVo">
		<![CDATA[
			select distinct prodname, hallname
			from 			product p, hall h, discount d
			where 			p.hall_no= h.hall_no
			and 			p.prod_no= d.prod_no
			and 			d.prod_no= #{prodNo}
		]]>
	</select>

	<!-- 이벤트할인 리스트 불러오기 (상시할인 제외) -->
	<select id="getList" parameterType="int" resultType="DiscountVo">
		<![CDATA[
			select			dc_no dcNo,
        					prod_no prodNo,
        					dcname,
        					to_char(begindc, 'YYYY"년"MM"월"DD"일"') beginDc,
        					to_char(enddc, 'YYYY"년"MM"월"DD"일"') endDc,
        					dcrate,
        					dctype
			from 			discount
			where 			begindc is not null
			and 			enddc is not null
			and				prod_no= #{prodNo}
		]]>
	</select>


	<!-- 이벤트할인 추가 -->
	<insert id="addDis" parameterType="DiscountVo">
		<selectKey keyProperty="dcNo" resultType="int" order="BEFORE">
			select seq_dc_no.nextval from dual
		</selectKey>
		
		<![CDATA[
			insert into	 discount
			values		 (#{dcNo}, #{prodNo}, #{dcName}, #{beginDc}, #{endDc}, #{dcRate}, #{dcType})
		]]>
	</insert>






	<select id="getDis" parameterType="DiscountVo" resultType="DiscountVo">
		<![CDATA[
			select			dc_no dcNo,
     						prod_no prodNo,
     						dcname,
     						to_char(begindc, 'YYYY"년"MM"월"DD"일"') beginDc,
     						to_char(enddc, 'YYYY"년"MM"월"DD"일"') endDc,
     						dcrate,
     						dctype
			from 			discount
			where 			dc_no= #{dcNo}
		]]>
	</select>


	<delete id="delDis" parameterType="DiscountVo">
		<![CDATA[
			delete from discount
			where 		dc_no= #{dcNo}
		]]>
	</delete>

</mapper>