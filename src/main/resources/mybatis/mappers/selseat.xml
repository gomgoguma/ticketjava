<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="selseat">
	
	<insert id="insertPre" parameterType="SelseatVo">
	    <selectKey resultType="int" keyProperty="selseatNo" order="BEFORE">
	        SELECT seq_selseat_no.nextval FROM dual     
	    </selectKey>    
	    <![CDATA[
		    INSERT INTO selseat( selseat_no , rez_no, grade, section, col, num, status, pretime )
		    			VALUES(#{selseatNo}, #{rezNo}, #{grade},#{section} , #{col}, #{num}, 2, sysdate )
		]]>
	</insert>  
	
	<select id="selectSelList" parameterType="map" resultType="SelseatVo">
		<![CDATA[
			select selseat_no selseatNo,
				   grade,
				   section,
				   col,
				   num
			from selseat
			where selseat_no in
		]]>
		<foreach collection="array" item="item" index="index" open="(" close=")" separator=",">
			#{item}
		</foreach>
		
	</select>
	
	<select id="selectTimeOver" resultType="int">
		<![CDATA[
			select  distinct rez_no
			from selseat
			where (sysdate-pretime)*24*60*60 > 600 and status = 2
		]]>
		
	</select>
	
	<select id="selectOccupy" resultType="SelseatVo" parameterType="ReservationVo">
		<![CDATA[
			select grade,
			       section,
			       col,
			       num
			from selseat s, reserve r
			where s.rez_no = r.rez_no and
			      prod_no = #{prodNo} and
			      viewDate = #{viewDate}
		]]>
		
	</select>
	
	<update id="updateDcPay" parameterType="SelseatVo">
		<![CDATA[
			update selseat
			set
		]]>
				<if test="dcNo != 0">
					dc_no = #{dcNo},
				</if>
		<![CDATA[
				payment = #{payment}
			where selseat_no = #{selseatNo}		
		]]>
	</update>
	
	<update id="updateStatus" parameterType="int">
		<![CDATA[
			update selseat
			set status = 1
			where rez_no = #{rezNo}
		]]>
	</update>
	
</mapper>